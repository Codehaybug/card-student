#!/bin/bash

# Student ID Card API - Auto Setup for Vercel
echo "ðŸŽ“ Student ID Card API - Auto Setup for Vercel"
echo "================================================"

# MÃ u sáº¯c cho output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Check if git is installed
if ! command -v git &> /dev/null; then
    echo -e "${RED}âŒ Git chÆ°a Ä‘Æ°á»£c cÃ i Ä‘áº·t!${NC}"
    exit 1
fi

# Check if npm is installed
if ! command -v npm &> /dev/null; then
    echo -e "${RED}âŒ npm chÆ°a Ä‘Æ°á»£c cÃ i Ä‘áº·t!${NC}"
    exit 1
fi

# Project name
PROJECT_NAME="student-id-vercel"
echo -e "${BLUE}ðŸ“ Táº¡o project: ${PROJECT_NAME}${NC}"

# Create project directory
if [ -d "$PROJECT_NAME" ]; then
    echo -e "${YELLOW}âš ï¸  ThÆ° má»¥c ${PROJECT_NAME} Ä‘Ã£ tá»“n táº¡i!${NC}"
    read -p "Báº¡n cÃ³ muá»‘n xÃ³a vÃ  táº¡o láº¡i? (y/n): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        rm -rf "$PROJECT_NAME"
    else
        echo -e "${RED}âŒ Setup bá»‹ há»§y${NC}"
        exit 1
    fi
fi

mkdir "$PROJECT_NAME"
cd "$PROJECT_NAME"

echo -e "${GREEN}âœ… ÄÃ£ táº¡o thÆ° má»¥c project${NC}"

# Initialize git
git init
echo -e "${GREEN}âœ… ÄÃ£ khá»Ÿi táº¡o git${NC}"

# Create directory structure
mkdir -p api
echo -e "${GREEN}âœ… ÄÃ£ táº¡o cáº¥u trÃºc thÆ° má»¥c${NC}"

# Create package.json
echo -e "${BLUE}ðŸ“ Táº¡o package.json...${NC}"
cat > package.json << 'EOF'
{
  "name": "student-id-card-vercel",
  "version": "1.0.0",
  "description": "Student ID Card Generator API for Vercel",
  "main": "api/generate-card.js",
  "type": "module",
  "scripts": {
    "dev": "vercel dev",
    "build": "echo 'No build step required'",
    "start": "vercel --prod"
  },
  "keywords": [
    "student-id",
    "card-generator", 
    "vercel",
    "api",
    "puppeteer"
  ],
  "author": "Your Name",
  "license": "MIT",
  "dependencies": {
    "chrome-aws-lambda": "^10.1.0",
    "puppeteer-core": "^21.5.2"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}
EOF

# Create vercel.json
echo -e "${BLUE}âš™ï¸  Táº¡o vercel.json...${NC}"
cat > vercel.json << 'EOF'
{
  "version": 2,
  "functions": {
    "api/generate-card.js": {
      "maxDuration": 30
    },
    "api/random-info.js": {
      "maxDuration": 10
    }
  },
  "headers": [
    {
      "source": "/api/(.*)",
      "headers": [
        {
          "key": "Access-Control-Allow-Origin",
          "value": "*"
        },
        {
          "key": "Access-Control-Allow-Methods", 
          "value": "GET, POST, OPTIONS"
        },
        {
          "key": "Access-Control-Allow-Headers",
          "value": "X-Requested-With, Content-Type, Authorization"
        }
      ]
    }
  ],
  "rewrites": [
    {
      "source": "/",
      "destination": "/api/docs"
    }
  ]
}
EOF

# Create .gitignore
echo -e "${BLUE}ðŸš« Táº¡o .gitignore...${NC}"
cat > .gitignore << 'EOF'
node_modules/
.env
.env.local
.env.production.local
.vercel
*.log
.DS_Store
EOF

# Create main API files (simplified versions due to script limitations)
echo -e "${BLUE}ðŸš€ Táº¡o API files...${NC}"

# Generate basic structure for API files
echo "// Generated by setup script - Please replace with full version from artifacts" > api/generate-card.js
echo "// Generated by setup script - Please replace with full version from artifacts" > api/random-info.js
echo "// Generated by setup script - Please replace with full version from artifacts" > api/docs.js

# Create README
echo -e "${BLUE}ðŸ“– Táº¡o README.md...${NC}"
cat > README.md << 'EOF'
# Student ID Card Generator API

ðŸŽ“ API táº¡o tháº» sinh viÃªn vá»›i thÃ´ng tin random hoáº·c tÃ¹y chá»‰nh, tá»‘i Æ°u cho Vercel.

## ðŸš€ Deploy lÃªn Vercel

1. **Thay tháº¿ API files:**
   - Copy ná»™i dung tá»« artifacts vÃ o `api/generate-card.js`
   - Copy ná»™i dung tá»« artifacts vÃ o `api/random-info.js`  
   - Copy ná»™i dung tá»« artifacts vÃ o `api/docs.js`

2. **Deploy:**
   ```bash
   npm install -g vercel
   vercel
   ```

## ðŸ“‹ API Endpoints

- `GET /api/generate-card` - Táº¡o tháº» random
- `POST /api/generate-card` - Táº¡o tháº» tÃ¹y chá»‰nh
- `GET /api/random-info` - Láº¥y thÃ´ng tin random
- `GET /` - Documentation

## ðŸ”§ Local Development

```bash
npm install
vercel dev
```

## ðŸ“ž Support

Xem documentation Ä‘áº§y Ä‘á»§ trong artifacts!
EOF

# Initialize git commit
echo -e "${BLUE}ðŸ“ Táº¡o initial commit...${NC}"
git add .
git commit -m "Initial setup with basic structure

- Added package.json with Vercel-optimized dependencies
- Added vercel.json with serverless function configs
- Created API folder structure
- Added .gitignore and README

Next steps:
1. Replace API files with full versions from artifacts
2. Deploy to Vercel"

echo -e "${GREEN}âœ… Setup hoÃ n thÃ nh!${NC}"
echo
echo -e "${YELLOW}ðŸ“‹ CÃ¡c bÆ°á»›c tiáº¿p theo:${NC}"
echo -e "${BLUE}1.${NC} cd $PROJECT_NAME"
echo -e "${BLUE}2.${NC} Thay tháº¿ ná»™i dung trong api/ báº±ng code tá»« artifacts"
echo -e "${BLUE}3.${NC} npm install -g vercel (náº¿u chÆ°a cÃ³)"
echo -e "${BLUE}4.${NC} vercel (Ä‘á»ƒ deploy)"
echo
echo -e "${YELLOW}ðŸ”— Hoáº·c push lÃªn GitHub vÃ  import vÃ o Vercel:${NC}"
echo -e "${BLUE}1.${NC} Táº¡o repo má»›i trÃªn GitHub"
echo -e "${BLUE}2.${NC} git remote add origin <your-repo-url>"
echo -e "${BLUE}3.${NC} git push -u origin main"
echo -e "${BLUE}4.${NC} Import repo trong Vercel dashboard"
echo
echo -e "${GREEN}ðŸŽ‰ Happy coding!${NC}"
